# Supabase Database Schema - MTI PTK

## Tables Overview

### 1. users
```sql
CREATE TABLE public.users (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  nrp text NOT NULL,
  password text NOT NULL,
  name text NOT NULL,
  jabatan text NULL,
  updated_at timestamp with time zone NULL DEFAULT now(),
  status text NULL,
  "group" text NULL,
  status_group text NULL,
  sisa_cuti integer NULL DEFAULT 14,
  credit_slot integer NULL DEFAULT 50,
  kontak text NULL,
  CONSTRAINT users_pkey PRIMARY KEY (id),
  CONSTRAINT users_nrp_key UNIQUE (nrp)
);
```
- **id**: UUID primary key
- **nrp**: Unique employee number (text)
- **password**: User password
- **name**: Full name
- **jabatan**: Position/role (text reference)
- **group**: Group name (text reference)
- **sisa_cuti**: Remaining leave days (default 14)
- **credit_slot**: Credit slots (default 50)
- **kontak**: Contact information

### 2. jabatan (Positions)
```sql
CREATE TABLE public.jabatan (
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  nama text NULL,
  "permissionCuti" boolean NULL,
  "permissionEksepsi" boolean NULL,
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  "permissionAllCuti" boolean NULL,
  "permissionAllEksepsi" boolean NULL,
  "permissionInsentif" boolean NULL,
  "permissionAtk" boolean NULL,
  "permissionAllInsentif" boolean NULL,
  "permissionSuratKeluar" boolean NULL,
  "permissionManagementData" boolean NULL,
  CONSTRAINT jabatan_pkey PRIMARY KEY (id)
);
```
- **id**: UUID primary key
- **nama**: Position name
- **permissionCuti**: Can approve leave
- **permissionEksepsi**: Can approve exceptions
- **permissionAllCuti**: Can view all leave requests
- **permissionAllEksepsi**: Can view all exceptions
- **permissionInsentif**: Can manage incentives
- **permissionAtk**: Can manage office supplies (ATK)
- **permissionAllInsentif**: Can view all incentives
- **permissionSuratKeluar**: Can manage outgoing letters
- **permissionManagementData**: Can manage system data

### 3. group
```sql
CREATE TABLE public.group (
  id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  nama text NULL,
  CONSTRAINT group_pkey PRIMARY KEY (id)
);
```
- **id**: BigInt auto-increment primary key
- **nama**: Group name

### 4. supervisor
```sql
CREATE TABLE public.supervisor (
  id serial NOT NULL,
  nama character varying(255) NOT NULL,
  jabatan character varying(255) NOT NULL,
  jenis character varying(50) NOT NULL,
  created_at timestamp with time zone NULL DEFAULT now(),
  updated_at timestamp with time zone NULL DEFAULT now(),
  CONSTRAINT supervisor_pkey PRIMARY KEY (id),
  CONSTRAINT supervisor_jenis_check CHECK (
    (jenis::text = ANY (
      ARRAY[
        'Penunjang'::character varying,
        'Logistik'::character varying,
        'Manager_PDS'::character varying
      ]::text[]
    ))
  )
);
```
- **id**: Serial primary key
- **nama**: Supervisor name
- **jabatan**: Position
- **jenis**: Type (enum: 'Penunjang', 'Logistik', 'Manager_PDS')

### 5. insentif_lembur (Overtime Incentives)
```sql
CREATE TABLE public.insentif_lembur (
  id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  nama text NULL,
  nominal integer NULL,
  users_id uuid NULL DEFAULT gen_random_uuid(),
  bulan date NULL,
  tahun integer NULL,
  nrp text NULL,
  CONSTRAINT insentif_lembur_pkey PRIMARY KEY (id),
  CONSTRAINT insentif_lembur_unique_user_tahun_bulan UNIQUE (users_id, tahun, bulan),
  CONSTRAINT insentif_lembur_users_id_fkey FOREIGN KEY (users_id) REFERENCES users(id)
);
```
- **id**: BigInt auto-increment primary key
- **nama**: Employee name
- **nominal**: Incentive amount
- **users_id**: Foreign key to users table
- **bulan**: Month (date)
- **tahun**: Year
- **nrp**: Employee number

### 6. insentif_premi (Bonus Incentives)
```sql
CREATE TABLE public.insentif_premi (
  id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  nama text NULL,
  nominal integer NULL,
  users_id uuid NULL,
  nrp text NULL,
  bulan date NULL,
  tahun integer NULL,
  CONSTRAINT insentif_premi_pkey PRIMARY KEY (id),
  CONSTRAINT insentif_premi_users_bulan_date_key UNIQUE (users_id, bulan),
  CONSTRAINT insentif_premi_users_id_fkey FOREIGN KEY (users_id) REFERENCES users(id)
);
```
- **id**: BigInt auto-increment primary key
- **nama**: Employee name
- **nominal**: Incentive amount
- **users_id**: Foreign key to users table
- **bulan**: Month (date)
- **tahun**: Year
- **nrp**: Employee number

### 7. surat_keluar (Outgoing Letters)
```sql
CREATE TABLE public.surat_keluar (
  id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  nama_perusahaan text NULL,
  deskripsi_surat text NULL,
  nomor_surat text NULL,
  url_ttd character varying NULL,
  judul_surat text NULL,
  CONSTRAINT surat_keluar_pkey PRIMARY KEY (id)
);
```
- **id**: BigInt auto-increment primary key
- **nama_perusahaan**: Company name
- **judul_surat**: Letter title
- **nomor_surat**: Letter number
- **deskripsi_surat**: Letter description
- **url_ttd**: Signature URL

### 8. cuti (Leave Requests)
```sql
CREATE TABLE public.cuti (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  lama_cuti integer NULL,
  alasan_cuti text NULL,
  nama text NULL,
  list_tanggal_cuti character varying NULL,
  url_ttd text NULL,
  sisa_cuti integer NULL,
  tanggal_pengajuan timestamp with time zone NULL,
  users_id uuid NULL,
  kunci_cuti boolean NULL,
  jenis_cuti text NULL,
  CONSTRAINT cuti_pkey PRIMARY KEY (id),
  CONSTRAINT cuti_users_id_fkey FOREIGN KEY (users_id) REFERENCES users(id)
);
```
- **id**: UUID primary key
- **lama_cuti**: Leave duration
- **alasan_cuti**: Leave reason
- **nama**: Employee name
- **list_tanggal_cuti**: List of leave dates
- **jenis_cuti**: Leave type
- **users_id**: Foreign key to users table

### 9. eksepsi (Exceptions)
```sql
CREATE TABLE public.eksepsi (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  jenis_eksepsi text NOT NULL,
  tanggal_pengajuan timestamp with time zone NULL DEFAULT now(),
  created_at timestamp with time zone NULL DEFAULT now(),
  updated_at timestamp with time zone NULL DEFAULT now(),
  url_ttd_eksepsi text NULL,
  CONSTRAINT eksepsi_pkey PRIMARY KEY (id),
  CONSTRAINT eksepsi_user_id_fkey FOREIGN KEY (user_id) REFERENCES users(id)
);
```

### 10. eksepsi_tanggal (Exception Dates)
```sql
CREATE TABLE public.eksepsi_tanggal (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  eksepsi_id uuid NOT NULL,
  tanggal_eksepsi date NOT NULL,
  urutan integer NOT NULL,
  created_at timestamp with time zone NULL DEFAULT now(),
  alasan_eksepsi text NULL,
  CONSTRAINT eksepsi_tanggal_pkey PRIMARY KEY (id),
  CONSTRAINT unique_eksepsi_urutan UNIQUE (eksepsi_id, urutan),
  CONSTRAINT eksepsi_tanggal_eksepsi_id_fkey FOREIGN KEY (eksepsi_id) REFERENCES eksepsi(id)
);
```

## Important Notes for Development

1. **Foreign Key Relationships**:
   - `users.group` is text (group name), not a foreign key
   - `users.jabatan` is text (position name), not a foreign key
   - Use text matching instead of foreign key joins

2. **Supervisor Table Structure**:
   - Different from what was implemented in code
   - Has `nama`, `jabatan`, `jenis` columns
   - `jenis` is an enum with specific values

3. **Permission Columns**:
   - Use camelCase column names like `permissionCuti`, `permissionEksepsi`, etc.

4. **Data Types**:
   - `group.id` is `bigint`, not `uuid`
   - `supervisor.id` is `serial`
   - Date columns use `date` type for month/year

5. **Unique Constraints**:
   - Overtime incentives: unique per user per month
   - Bonus incentives: unique per user per month
   - Users: unique NRP

This schema should be used as reference for all database operations in the Flutter app.